# Neural Pfaffians: Solving Many Many-Electron Schrödinger Equations

Nicholas Gao, Stephan Günnemann {n.gao,s.guennemann}@tum.de Department of Computer Science & Munich Data Science Institute Technical University of Munich

# Abstract

Neural wave functions accomplished unprecedented accuracies in approximating the ground state of many-electron systems, though at a high computational cost. Recent works proposed amortizing the cost by learning generalized wave functions across different structures and compounds instead of solving each problem independently. Enforcing the permutation antisymmetry of electrons in such generalized neural wave functions remained challenging as existing methods require discrete orbital selection via non-learnable hand-crafted algorithms. This work tackles the problem by defining overparametrized, fully learnable neural wave functions suitable for generalization across molecules. We achieve this by relying on Pfaffians rather than Slater determinants. The Pfaffian allows us to enforce the antisymmetry on arbitrary electronic systems without any constraint on electronic spin configurations or molecular structure. Our empirical evaluation finds that a single neural Pfaffian calculates the ground state and ionization energies with chemical accuracy across various systems. On the TinyMol dataset, we outperform the ‘gold-standard’ CCSD(T) CBS reference energies by $1 . 9 \mathrm { m } E _ { \mathrm { h } }$ and reduce energy errors compared to previous generalized neural wave functions by up to an order of magnitude.

# 1 Introduction

Solving the electronic Schrödinger equation is at the heart of computational chemistry and drug discovery. Its solution provides a molecule’s or material’s electronic structure and energy (Zhang et al., 2023). While the exact solution is infeasible, neural networks have recently shown unprecedentedly accurate approximations (Hermann et al., 2023). These neural networks approximate the system’s ground-state wave function $\Psi : \mathbb { R } ^ { N _ { \mathrm { e } } \times 3 }  \mathbb { R }$ , the lowest energy state, by minimizing the energy $\langle \Psi | \hat { H } | \Psi \rangle$ , where $\hat { H }$ is the Hamiltonian operator, a mathematical description of the system. While such neural wave functions are highly accurate, training has proven computationally intensive.

Gao & Günnemann (2022) have shown that training a generalized neural wave function on a large class of systems amortizes the cost. However, their approach is limited to different geometric arrangements of the same molecule. Subsequent works eliminated this limitation by introducing hand-crafted algorithms (Gao & Günnemann, 2023a) or heavily relying on classical Hartree-Fock calculations (Scherbela et al., 2023). Both impose strict, non-learnable mathematical constraints and prior assumptions that may not always hold, limiting their generalization and accuracies. Handcrafted algorithms only work for a limited set of molecules, in particular organic molecules near equilibrium, while the reliance on Hartree-Fock empirically results in degraded accuracies.

In this work, we propose the Neural Pfaffian (NeurPf) to overcome these limitations. As suggested by its name, NeurPf uses Pfaffians to define a superset of the previously used Slater determinants to enforce the fermionic antisymmetry. The Pfaffian lifts the constraint on the number of molecular orbitals from Slater determinants (Szabo & Ostlund, 2012), enabling overparametrized wave functions with simpler and more accurate generalization. Compared to Globe (Gao & Günnemann, 2023a), the absence of hand-crafted algorithms enables the modeling of non-equilibrium, ionized, or excited systems. By being fully learnable without fixed Hartree-Fock calculations like TAO (Scherbela et al., 2024), NeurPf achieves significantly lower variational energies. Our empirical results show that NeurPf can learn all second-row elements’ ground-state, ionization, and electron affinity potentials with a single wave function. Further, we demonstrate that NeurPf’s accuracy surpasses Globe on the challenging nitrogen dimer with seven times fewer parameters while not suffering from performance degradations when adding structures to the training set. On the TinyMol dataset, NeurPf surpasses the highly accurate reference CCSD(T) CBS energies on the small structures by $1 . 9 \mathrm { m } E _ { \mathrm { h } }$ and reduces errors compared to TAO by factors of 10 and 6 on the small and large structures, respectively.

# 2 Quantum chemistry

Quantum chemistry aims to solve the time-independent Schrödinger equation (Foulkes et al., 2001)

$$
{ \hat { H } } \left| \Psi \right. = E \left| \Psi \right.
$$

where $\Psi : \mathbb { R } ^ { N _ { \uparrow } \times 3 } \times \mathbb { R } ^ { N _ { \downarrow } \times 3 }  \mathbb { R }$ is the electronic wave function for $N _ { \uparrow }$ spin-up and $N _ { \downarrow }$ spin-down electrons, $\hat { H }$ is the Hamiltonian operator, and $E$ is the system’s energy. To ease notation, if not necessary, we omit spins in $\Psi$ and treat it as $\Psi : \mathbb { R } ^ { N _ { \mathrm { e } } \times 3 }  \dot { \mathbb { R } }$ where $N _ { \mathrm { e } } = N _ { \uparrow } + N _ { \downarrow }$ . The Hamiltonian $\hat { H }$ for molecular systems, which we are concerned with in this work, is given by

$$
\hat { H } = - \frac { 1 } { 2 } \sum _ { i = 1 } ^ { N _ { \mathrm { e } } } \sum _ { k = 1 } ^ { 3 } \frac { \partial ^ { 2 } } { \partial \vec { r } _ { i k } ^ { 2 } } + \sum _ { j > i } ^ { N _ { \mathrm { e } } } \frac { 1 } { \| \vec { r } _ { i } - \vec { r } _ { j } \| } - \sum _ { i = 1 } ^ { N _ { \mathrm { e } } } \sum _ { m = 1 } ^ { N _ { \mathrm { n } } } \frac { Z _ { m } } { \| \vec { r } _ { i } - \vec { R } _ { m } \| } + \sum _ { n > m } ^ { N _ { \mathrm { n } } } \frac { Z _ { m } Z _ { n } } { \| \vec { R } _ { m } - \vec { R } _ { n } \| }
$$

with $\vec { r _ { i } } \in \mathbb { R } ^ { 3 }$ being the ith electron’s position, and $\vec { R } _ { m } \in \mathbb { R } ^ { 3 } , Z _ { m } \in \mathbb { N } _ { + }$ being the mth nucleus’ position and charge. The wave function $\Psi$ describes the behavior of electrons in the system defined by the Hamiltonian $\hat { H }$ . As the square of the wave function $\Psi ^ { 2 }$ is proportional to the probability density $p ( \vec { \mathbf { r } } ) \propto \Psi ^ { 2 } ( \vec { \mathbf { r } } )$ of finding the electrons at positions $\vec { \mathbf { r } } \in \mathbb { R } ^ { N _ { \mathrm { e } } \times \frac { 1 } { 3 } }$ , its integral must be finite:

$$
\int \Psi ( \vec { \bf r } ) ^ { 2 } \mathrm { d } \vec { \bf r } < \infty .
$$

Further, as electrons are indistinguishable half-spin fermionic particles, the wave function must be antisymmetric under any same-spin electron permutation $\tau$ :

$$
\Psi \left( \tau ^ { \uparrow } ( \vec { \bf r } ^ { \uparrow } ) , \tau ^ { \downarrow } ( \vec { \bf r } ^ { \downarrow } ) \right) = \mathrm { s g n } ( \tau ^ { \uparrow } ) \mathrm { s g n } ( \tau ^ { \downarrow } ) \Psi ( \vec { \bf r } ) .
$$

To enforce this constraint, the wave function is typically defined as a so-called Slater determinant of $N _ { \mathord { \uparrow } } + N _ { \mathord { \downarrow } }$ integrable so-called orbital functions $\dot { \phi _ { i } } : \mathbb { R } ^ { 3 }  \mathbb { R }$ :

$$
\Psi _ { \mathrm { S l a t e r } } ( \vec { \bf r } ) = \operatorname * { d e t } \left[ \phi _ { j } ^ { \uparrow } ( \vec { r } _ { i } ^ { \uparrow } ) \right] \operatorname * { d e t } \left[ \phi _ { j } ^ { \uparrow } ( \vec { r } _ { i } ^ { \downarrow } ) \right] = \operatorname * { d e t } \Phi ^ { \uparrow } ( \vec { \bf r } ^ { \uparrow } ) \operatorname * { d e t } \Phi ^ { \downarrow } ( \vec { \bf r } ^ { \downarrow } ) .
$$

Note that for the determinant to exist, one needs exactly $N _ { \uparrow }$ up and $N _ { \downarrow }$ down orbitals ${ \boldsymbol { \phi } } _ { j } ^ { \dagger }$ and $\phi _ { j } ^ { \downarrow }$

In linear algebra, Eq. (1) is an eigenvalue problem, where we look for the eigenfunction $\Psi _ { 0 }$ with the lowest eigenvalue $E _ { 0 }$ . In Variational Monte Carlo (VMC), this is solved by applying the variational principle, which states that the energy of any trial wave function $\Psi$ upper bounds $E _ { 0 }$ :

$$
E _ { 0 } \leq \frac { \langle \Psi \vert \hat { H } \vert \Psi \rangle } { \langle \Psi ^ { 2 } \rangle } = \frac { \int \Psi ( \vec { \bf r } ) \hat { H } \Psi ( \vec { \bf r } ) \mathrm { d } \vec { \bf r } } { \int \Psi ^ { 2 } ( \vec { \bf r } ) \mathrm { d } \vec { \bf r } } .
$$

By plugging in the probability distribution from Eq. (3), we can rewrite Eq. (6) as

$$
E _ { 0 } \le \mathbb { E } _ { p ( \vec { \mathbf { r } } ) } \left[ \Psi ^ { - 1 } ( \vec { \mathbf { r } } ) \hat { H } \Psi ( \vec { \mathbf { r } } ) \right] = \mathbb { E } _ { p ( \vec { \mathbf { r } } ) } \left[ E _ { L } ( \vec { \mathbf { r } } ) \right] ,
$$

with $E _ { L } ( \vec { \mathbf { r } } ) = \Psi ( \vec { \mathbf { r } } ) ^ { - 1 } \hat { H } \Psi ( \vec { \mathbf { r } } )$ being the so-called local energy. The right-hand side of Eq. (7) is known as the variational energy. As Eq. (7) does not require $\Psi$ to be an analytic function, we can approximate the energy of any valid wave function $\Psi$ with samples drawn from $p ( \vec { \mathbf { r } } )$ . If we pick a

parametrized family of wave functions $\Psi _ { \theta }$ , we can optimize the parameters $\theta$ to minimize the VMC energy by following the gradient of the variational energy

$$
\nabla _ { \boldsymbol { \theta } } = \mathbb { E } _ { p ( \vec { \mathbf { r } } ) } \left[ \left( E _ { L } ( \vec { \mathbf { r } } ) - \mathbb { E } _ { p ( \vec { \mathbf { r } } ) } \left[ E _ { L } ( \vec { \mathbf { r } } ) \right] \right) \nabla _ { \boldsymbol { \theta } } \log \Psi _ { \boldsymbol { \theta } } ( \vec { \mathbf { r } } ) \right] ,
$$

where we approximate all expectations by Monte Carlo sampling (Ceperley et al., 1977).

Neural wave functions typically keep the functional form of Eq. (5) but replace the orbitals $\phi _ { i }$ with learned many-electron orbitals $\phi _ { i } ^ { \mathrm { { N N } } } : \dot { \mathbb { R } } ^ { 3 } \times \mathbb { R } ^ { N _ { \mathrm { { e } } } \times 3 }  \mathbb { R }$ (Hermann et al., 2023). These many-electron orbitals $\phi _ { i } ^ { \mathrm { N N } }$ are implemented as different readouts of the same permutation-equivariant neural network. Multiplying each orbital by an envelope function $\chi _ { i } : \mathbb { R } ^ { 3 } \overset { \cdot } {  } \mathbb { R }$ that decays exponentially to zero at large distances enforces the finite integral requirement in Eq. (3).

Generalized wave functions solve the more general problem where the nucleus positions $\vec { \bf R }$ and charges $\mathbf { Z }$ are not fixed. Since the Hamiltonian $\hat { H } _ { \vec { \bf R } , { \bf Z } }$ depends on the molecular structure $( \vec { \bf R } , { \bf Z } )$ , so does the corresponding ground state wave function $\Psi _ { \vec { \mathbf { R } } , \mathbf { Z } }$ . Note that we still work in the Born-Oppenheimer approximation, i.e., we treat the nuclei as classical point charges (Zhang et al., 2023). Given a dataset of molecular structures $\mathcal { D } ~ = ~ \{ ( \vec { \bf R } _ { 1 } , { \bf Z } _ { 1 } ) , \ldots \}$ , the total energy $\begin{array} { r } { \sum _ { ( \vec { \mathbf { R } } , \mathbf { Z } ) \in \mathcal { D } } \frac { \langle \Psi _ { \vec { \mathbf { R } } , \mathbf { Z } } | \hat { H } _ { \vec { \mathbf { R } } , \mathbf { Z } } | \Psi _ { \vec { \mathbf { R } } , \mathbf { Z } } \rangle } { \langle \Psi _ { \vec { \mathbf { R } } , \mathbf { Z } } ^ { 2 } \rangle } } \end{array}$ ⟨Ψ⃗R,Z|HΨˆ2⃗R,Z|Ψ⃗R,Z⟩ is minimized to approximate the ground state for each structure. Typically, the dependence on $\vec { \bf R } , { \bf Z }$ is implemented by using a meta network that takes $\vec { \bf R } , { \bf Z }$ as inputs and outputs the parameters of the electronic wave function (Gao & Günnemann, 2022).

# 3 Related work

While attempts to enforce the fermionic antisymmetry in neural wave functions in less than $O ( N _ { \mathrm { e } } ^ { 3 } )$ operations promise faster runtime than Slater determinants, the accuracy of these methods is limited (Han et al., 2019; Acevedo et al., 2020; Richter-Powell et al., 2023). Pfau et al. (2020) and Hermann et al. (2020) established Slater determinants for neural wave functions by demonstrating chemical accuracy on small molecules. Note, Eq. (5) may also be written via a block-diagonal matrix, i.e., $\Psi ( \vec { \mathbf { r } } ) = \operatorname* { d e t } \big ( \mathrm { d i a g } ( \Phi ^ { \uparrow } , \Phi ^ { \downarrow } ) \big )$ . Spencer et al. (2020)’s implementation further increased accuracies by parametrizing the off diagonals that were implicitly set to 0 before, with additional orbitals $\tilde { \Phi }$ :

$$
\Psi _ { \mathrm { S l a t e r } } ( \vec { \bf r } ) = \operatorname * { d e t } ( \hat { \Phi } ( \vec { \bf r } ) ) = \operatorname * { d e t } \left[ { \Phi ^ { \uparrow } } ( \vec { \bf r } ^ { \uparrow } ) \mathrm {  ~ \ } \tilde { \Phi } ^ { \uparrow } ( \vec { \bf r } ^ { \uparrow } ) \right] .
$$

Several works confirmed the improved empirical accuracy of this approach (Gerard et al., 2022; Lin et al., 2021; Ren et al., 2023; Gao & Günnemann, 2023b, 2024). While later works refined the architecture to increase accuracy (von Glehn et al., 2023; Wilson et al., 2021, 2023), the use of Slater determinants mostly remained a constant, with two notable exceptions: Firstly, Lou et al. (2023) use AGP wave functions (Casula & Sorella, 2003; Casula et al., 2004) to formulate the wave function as $\Psi ( \vec { \bf r } ) = \operatorname * { d e t } ( \Phi ^ { \uparrow } ) \operatorname * { d e t } ( \Phi ^ { \downarrow } ) = \operatorname * { d e t } ( \Phi ^ { \uparrow } \Phi ^ { \downarrow T } )$ . This avoids picking exactly $N _ { \uparrow } / N _ { \downarrow }$ orbitals as $\Phi ^ { \uparrow }$ and $\Phi ^ { \downarrow }$ may be non-square but fails to generalize Eq. (9), we empirically verify the impact of this limitation in App. I. Secondly, Kim et al. (2023) introduced the combination of neural networks and Pfaffians, who demonstrated its performance on the ultra-cold Fermi gas. Though universal in theory, their parametrization yields no trivial adaption to molecular systems. In classical quantum chemistry, Bajdich et al. (2006, 2008) reported promising early results with Pfaffians in single-structure calculations for small molecules. In this work, we generalize Eq. (9) to Pfaffian wave functions that permit pretraining with Hartree-Fock calculations and generalization across molecules.

Generalized wave functions. Scherbela et al. (2022) started this research with a weight-sharing scheme between wave functions. These still had to be reoptimized for each structure. Later, Gao & Günnemann (2022, 2023b) proposed PESNet, a generalized wave function for energy surfaces allowing joint training without reoptimization. Subsequent works extended PESNet to different compounds where the main challenge is parametrizing exactly $N _ { \mathord { \uparrow } } + N _ { \mathord { \downarrow } }$ orbitals, such that the orbital matrix in Eq. (9) stays square. The problem of finding these orbitals was formulated into a discrete orbital selection problem. Gao & Günnemann (2023a)’s hand-crafted algorithm accomplishes this by selecting orbitals via a greedy nearest neighbor search. In contrast, Scherbela et al. (2024, 2023) use the lowest eigenvalues of the Fock matrix as selection criteria. Both introduce non-learnable constraints, limiting generalization or sacrificing accuracy. NeurPf avoids the selection problem by introducing an overparametrization when enforcing the exchange antisymmetry.

# 4 Neural Pfaffian

Previous generalized wave functions build on Slater wave functions and attempt to adjust the orbitals $\phi _ { i }$ to the molecule. Slater determinants were chosen due to their previously demonstrated high accuracy. However, they require exactly $N _ { \mathord { \uparrow } } + N _ { \mathord { \downarrow } }$ orbitals. While the nuclei allow inferring the total number of electrons $N _ { \mathrm { e } }$ of any stable, singlet state system, the spin distribution into $N _ { \uparrow }$ and $N _ { \downarrow }$ orbitals per atom is not readily available. Previous works implement this via a discrete selection of orbitals via non-learnable prior assumptions and constraints on the wave function; see Sec. 3.

Here, we present the Neural Pfaffian (NeurPf), a superset of Slater wave functions that preserves accuracy while relaxing the orbital number constraint. By not enforcing an exact number of orbitals, NeurPf is overparametrized with $N _ { \mathrm { o } } \geq \operatorname* { m a x } \{ N _ { \uparrow } , N _ { \downarrow } \}$ orbitals, avoiding discrete selections and making it a natural choice for generalized wave functions. Importantly, NeurPf can be pretrained with Hartree-Fock, which accounts for $> 9 9 \%$ of the total energy (Szabo & Ostlund, 2012). We introduce NeurPf in four steps: (1) We introduce the Pfaffian and use it to define a superset of Slater wave functions. (2) We present memory-efficient envelopes that additionally accelerate convergence. (3) We introduce a new pretraining scheme for matching Pfaffian and Slater wave functions. (4) We discuss combining our developments to build a generalized wave function.

# 4.1 Pfaffian wave function

The Pfaffian of a skew-symmetric $2 n \times 2 n$ matrix $A$ , i.e., $A = - A ^ { T }$ , is defined as

$$
\operatorname* { P f } ( A ) = { \frac { 1 } { 2 ^ { n } n ! } } \sum _ { \tau \in S _ { 2 n } } \operatorname { s g n } ( \tau ) \prod _ { i = 1 } ^ { n } A _ { \tau ( 2 i - 1 ) , \tau ( 2 i ) }
$$

where $S _ { 2 n }$ is the symmetric group of $2 n$ elements. One may consider it a square root of the determinant of $A$ since $\operatorname* { P f } ( A ) ^ { \bar { 2 } } = \operatorname* { i e t } ( A )$ . An important property of the Pfaffian is $\operatorname { P f } ( B A B ^ { T } ) =$ $\operatorname* { d e t } ( B ) \operatorname* { P f } ( A )$ for any invertible matrix $B$ and skew-symmetric matrix $A$ . In the context of neural wave functions, this means that if $A$ is an along both dimensions permutation equivariant function of the electron positions $\vec { \bf r }$ , $A ( \tau ( \vec { \bf r } ) ) = P _ { \tau } A ( \vec { \bf r } ) \bar { P } _ { \tau } ^ { T }$ , the Pfaffian of $A$ is a valid wave function that fulfills the antisymmetry requirement from Eq. (4):

$$
\Psi ( \tau ( \vec { \bf r } ) ) = \mathrm { P f } ( A ( \tau ( \vec { \bf r } ) ) ) = \mathrm { P f } ( P _ { \tau } A ( \vec { \bf r } ) P _ { \tau } ^ { T } ) = \operatorname * { d e t } ( P _ { \tau } ) \mathrm { P f } ( A ( \vec { \bf r } ) ) = \mathrm { s i g n } ( \tau ) \Psi ( \vec { \bf r } ) .
$$

To compute the Pfaffian without evaluating the $2 n !$ terms in Eq. (10), we implement the Pfaffian via a tridiagonalization with the Householder transformation as in Wimmer (2012).

There are various ways to construct $A$ (Bajdich et al., 2006, 2008; Kim et al., 2023). Here, we introduce a superset of Slater wave functions, enabling high accuracy on molecular systems. If $A$ is a skew-symmetric matrix, so is $B A B ^ { T }$ for any arbitrary matrix $B$ . Thus, we can construct $\Psi _ { \mathrm { P f a f f i a n } }$ as

$$
\Psi _ { \mathrm { P f a f f a n } } ( \vec { \bf r } ) = \frac { 1 } { \mathrm { P f } ( A _ { \mathrm { P f } } ) } \mathrm { P f } \left( \hat { \Phi } _ { \mathrm { P f } } ( \vec { \bf r } ) A _ { \mathrm { P f } } \hat { \Phi } _ { \mathrm { P f } } ( \vec { \bf r } ) ^ { T } \right)
$$

where $A _ { \mathrm { P f } } ~ \in ~ \mathbb { R } ^ { N _ { \mathrm { o } } \times N _ { \mathrm { o } } }$ is a learnable skew-symmetric matrix and $\hat { \Phi } _ { \mathrm { P f } } : \mathbb { R } ^ { N _ { \mathrm { e } } \times 3 }  \mathbb { R } ^ { N _ { \mathrm { e } } \times N _ { \mathrm { o } } }$ is a permutation equivariant function like in Eq. (9). This construction elevates the need for having exactly $N _ { \uparrow } / N _ { \downarrow }$ orbitals as in Slater determinants. We may now overparametrize the wave function with $N _ { \mathrm { o } } \geq \operatorname* { m a x } \{ N _ { \uparrow } , N _ { \downarrow } \}$ orbitals, allowing for a more flexible and simpler implementation without needing discrete orbital selection. By choosing $\hat { \Phi } _ { \mathrm { P f } } = \hat { \Phi }$ , it is straightforward to see that Eq. (12) is a superset of the Slater determinant wave function in Eq. (9). Note that, like in Eq. (9), we parametrize two sets of orbital functions $\Phi _ { \mathrm { P f } }$ and $\tilde { \Phi } _ { \mathrm { P f } }$ and change their order for spin-down electrons to not enforce the exchange antisymmetry between different-spin electrons. As the normalizer $\mathrm { P f } ( A _ { \mathrm { P f } } )$ is constant, we drop it going forward. As it is common in quantum chemistry (Szabo $\&$ Ostlund, 2012; Hermann et al., 2020), we use linear combinations of wave functions to increase expressiveness:

$$
\Psi _ { \mathrm { P f a f f i a n } } ( \vec { \bf r } ) = \sum _ { k = 1 } ^ { N _ { \mathrm { k } } } c _ { k } \Psi _ { \mathrm { P f a f f i a n } , k } ( \vec { \bf r } ) .
$$

We visually compare the schematic of the Slater determinant and Pfaffian wave functions in Fig. 1 In App. A, we discuss how to handle odd numbers of electrons such that $\hat { \Phi } _ { \mathrm { P f } } A _ { \mathrm { P f } } \hat { \Phi } _ { \mathrm { P f } } ^ { T }$ has even

![](images/943008492960a3951c26e46016798e4ddc822a14d06a30bfc103b80899125301.jpg)  
Fig. 1: Schematic of the Slater determinant (1a) and our NeurPf (1b). Where the Slater formulation requires exactly $N _ { \mathrm { e } }$ orbital functions, the Pfaffian formulation works for any number $N _ { \mathrm { o } } \geq \operatorname* { m a x } \{ \bar { N } _ { \uparrow } , N _ { \downarrow } \}$ of orbital functions, indicated by the rectangular orbital blocks.

dimensions. Like previous work (Pfau et al., 2020), we parametrize the orbital functions $\phi _ { i }$ as a product of a permutation equivariant neural network $h ~ \colon \mathbb { R } ^ { 3 } \times \mathbb { R } ^ { N \times 3 } \to \mathbb { R } ^ { N _ { \mathrm { f } } }$ and an envelope function $\chi : \dot { \mathbb { R } ^ { 3 } } \to \mathbb { R }$ :

$$
\phi _ { k i } ( \vec { r } _ { j } | \vec { \bf r } ) = \chi _ { k i } ( \vec { r } _ { j } ) \cdot h ( \vec { r } _ { j } | \vec { \bf r } ) ^ { T } w _ { k i } \cdot \eta _ { k i } ^ { N _ { \uparrow } - N _ { \downarrow } }
$$

with $\boldsymbol { w } _ { k i } \in \mathbb { R } ^ { N _ { \mathrm { f } } }$ being a learnable weight vector, and ηN↑−N↓ ∈ R being a scalar depending on the spin state of the system, i.e., the difference between the number of up and down electrons. The envelope function $\chi$ ensures that the integral of the squared wave function is finite. For $\boldsymbol { h }$ , we use Moon from Gao & Günnemann (2023a) thanks to its size consistency.

# 4.2 Memory-efficient envelopes

To satisfy the finite integral requirement on the square of $\Psi$ in Eq. (3), the orbitals $\phi$ are multiplied by an envelope function $\bar { \chi } : \mathbb { R } ^ { 3 } \overset { \cdot } {  } \mathbb { R }$ that exponentially decays to zero at large distances. We do not split spins here and work with $N _ { \mathrm { e } } = N _ { \uparrow } + N _ { \downarrow }$ to simplify the discussion, but, in practice, we would split the envelopes into two sets, one for $\Phi _ { \mathrm { P f } }$ and one for $\tilde { \Phi } _ { \mathrm { P f } }$ . The envelope function is typically a sum of exponentials centered on the nuclei (Spencer et al., 2020). In Einstein’s summation notation, the envelope function can be written as

$$
\chi _ { k i } ( { \vec { r } } _ { b j } ) = \underbrace { \pi _ { k m i } } _ { N _ { \mathbf { k } } \times N _ { \mathbf { n } } \times N _ { \mathrm { o } } } \cdot \underbrace { \exp ( - \sigma _ { k m i } \| { \vec { \mathbf { r } } } _ { b j } - { \vec { \mathbf { R } } } _ { m } \| ) _ { b k m j i } } _ { N _ { \mathbf { b } } \times N _ { \mathbf { k } } \times N _ { \mathbf { n } } \times N _ { \mathrm { e } } \times N _ { \mathrm { o } } }
$$

where $N _ { \mathrm { b } }$ denotes the batch size. Empirically, we found the tensor on the right side containing many redundant entries. Further, due to the nonlinearity of the exponential function, one cannot implement the envelope in a simple matrix contraction but has to materialize the full five-dimensional tensor. NeurPf amplifies this problem as $N _ { \mathrm { o } } \geq N _ { \mathrm { e } }$ whereas Slater determinants constraint $N _ { \mathrm { o } } = N _ { \mathrm { e } }$ .

We use a single set of exponentials per nucleus instead of having one for each combination of orbital and nucleus. This reduces the number of envelopes per electron from $N _ { \mathrm { k } } \times N _ { \mathrm { n } } \times N _ { \mathrm { o } }$ to $N _ { \mathrm { k } } \times N _ { \mathrm { e n v } }$ , where $N _ { \mathrm { e n v } } = N _ { \mathrm { n } } \times N _ { \mathrm { e n v / n u c } }$ is the number of envelope functions. In general, we pick $N _ { \mathrm { e n v / n u c } }$ such that $N _ { \mathrm { e n v } } \approx N _ { \mathrm { o } }$ . These atomic envelopes are linearly recombined into molecular envelopes, effectively enlarging $\pi$ to a $N _ { \mathrm { k } } \times N _ { \mathrm { o } } \times N _ { \mathrm { e n v } }$ tensor. Thanks to these rearrangements, we avoid constructing a five-dimensional tensor. Instead, we define the envelopes as

$$
\begin{array} { r } { \chi _ { k i } ( \vec { r } _ { b j } ) = \underbrace { \pi _ { k n i } } _ { N _ { \mathbf { k } } \times N _ { \mathrm { e n v } } \times N _ { \mathrm { o } } } \cdot \underbrace { \exp ( - \sigma _ { k n } \lVert \vec { r } _ { b j } - \vec { \mathbf { R } } _ { n } \rVert ) _ { k b n j } } _ { N _ { \mathrm { b } } \times N _ { \mathbf { k } } \times N _ { \mathrm { e n v } } \times N _ { \mathrm { e } } } . } \end{array}
$$

Concurrently, Pfau et al. (2024) presented similar bottleneck envelopes. However, we found ours to converge faster and not yield numerical instabilities. We discuss this further in App. B and I.

# 4.3 Pretraining Pfaffian wave functions

Pretraining is essential in training neural wave functions and has frequently been observed to critically affect final energies (Gao & Günnemann, 2023a; von Glehn et al., 2023; Gerard et al., 2022). The pretraining aims to find orbital functions close to the ground state to stabilize the optimization. Traditionally, this is done by matching the orbitals of the neural wave function to the orbitals of a baseline wave function, typically a Hartree-Fock wave function $\Psi _ { \mathrm { H F } } = \operatorname* { d e t } ( \Phi _ { \mathrm { H F } } )$ , by solving

$$
\operatorname* { m i n } _ { \theta } \| \Phi _ { \theta } - \Phi _ { \mathrm { H F } } \| _ { 2 } ^ { 2 } ,
$$

for the neural network parameters $\pmb \theta$ (Pfau et al., 2020). Since our Pfaffian has $N _ { \mathrm { o } }$ orbitals while Hartree-Fock has $N _ { \mathrm { e } }$ , we cannot directly apply this to our Pfaffian wave function. Further, as we predict orbitals per nucleus, our arbitrary orbital order may not align with Hartree-Fock.

We propose two alternative pretraining schemes for neural Pfaffian wave functions: one based on matching single-electron orbitals and one based on matching geminals, effectively two-electron orbitals. We need to expand the Hartree-Fock orbitals $\Phi ^ { \mathrm { H F } }$ to $N _ { \mathrm { o } }$ orbitals to match the single-electron orbitals directly. We construct $\bar { \Phi } ^ { \mathrm { H F } }$ by padding the extra $N _ { \mathrm { o } } - N _ { \mathrm { e } }$ orbitals with zeros. It can easily be verified that the wave function ΨHF-Pf = Pf1A¯HF $\begin{array} { r } { \check { \Psi } _ { \mathrm { H F - P f } } = \overset { \vartriangle } { \frac { 1 } { \operatorname { P f } \bar { A } _ { \mathrm { H F } } } } \operatorname* { P f } ( \bar { \Phi } _ { \mathrm { H F } } \bar { A } _ { \mathrm { H F } } \bar { \Phi } _ { \mathrm { H F } } ^ { T } ) } \end{array}$ , is equivalent to the original Hartree-Fock wave function, i.e., $\Psi _ { \mathrm { H F - P f } } = \Psi _ { \mathrm { H F } } = \operatorname* { d e t } ( \Phi _ { \mathrm { H F } } )$ for any invertible skew-symmetric $A _ { \mathrm { H F } }$ Further, note that the multiplication of $\bar { \Phi } _ { \mathrm { H F } }$ with any matrix $\dot { T } \in S O ( N _ { \mathrm { o } } )$ from the special orthogonal group does not change $\Psi _ { \mathrm { H F - P f } }$ . Thus, it suffices to match the single electron orbitals of $\hat { \Phi } _ { \mathrm { P f } }$ and $\bar { \Phi } _ { \mathrm { H F } }$ up to a rotation $T \in S O ( N _ { \mathrm { o } } )$ , yielding the following optimization problem:

$$
\operatorname* { m i n } _ { \theta } \operatorname* { m i n } _ { T \in S O ( N _ { \mathrm { o } } ) } \| \hat { \Phi } _ { \mathrm { P f } } - \bar { \Phi } _ { \mathrm { H F } } T \| _ { 2 } ^ { 2 } .
$$

We solve this alternatingly for $T$ and $\pmb \theta$ . To match the geminals $\hat { \Phi } _ { \mathrm { P f } } A _ { \mathrm { P f } } \hat { \Phi } _ { \mathrm { P f } } ^ { T }$ and $\Phi _ { \mathrm { H F } } A _ { \mathrm { H F } } \Phi _ { \mathrm { H F } } ^ { T }$ , we have to account for the fact that the choice of $A _ { \mathrm { H F } }$ is arbitrary as long as it is skew-symmetric and invertible. Again, we solve this optimization problem alternatingly by solving for $\overset { \cdot } { A _ { \mathrm { H F } } } \in \mathbb { S } = \left\{ A \in \right.$ $S O ( N _ { \mathrm { e } } ) : A { \overset { \smile } { = } } - A ^ { T } \rbrace$ and $\pmb \theta$ :

$$
\operatorname* { m i n } _ { \theta } \operatorname* { m i n } _ { A _ { \mathrm { H F } } \in \mathbb { S } } \| \hat { \Phi } _ { \mathrm { P f } } A _ { \mathrm { P f } } \hat { \Phi } _ { \mathrm { P f } } ^ { T } - \Phi _ { \mathrm { H F } } A _ { \mathrm { H F } } \Phi _ { \mathrm { H F } } ^ { T } \| _ { 2 } ^ { 2 } .
$$

While both formulations share the same minimizer, combining both yields the most stable results. We hypothesize that this is because the single-electron orbitals are more stable than the geminals and thus provide a better starting point for the optimization. In contrast, the latter provides a closer formulation of the neural network orbitals. Thus, we pretrain our neural Pfaffian wave functions by solving the optimization problem

$$
\operatorname* { m i n } _ { \theta } \left( \alpha \operatorname* { m i n } _ { T \in S O ( N _ { \mathrm { o } } ) } \| \hat { \Phi } _ { \mathrm { P f } } - \bar { \Phi } _ { \mathrm { H F } } T \| _ { 2 } ^ { 2 } + \beta \operatorname* { m i n } _ { A _ { \mathrm { H F } } \in \mathbb { S } } \| \hat { \Phi } _ { \mathrm { P f } } A _ { \mathrm { P f } } \hat { \Phi } _ { \mathrm { P f } } ^ { T } - \Phi _ { \mathrm { H F } } A _ { \mathrm { H F } } \Phi _ { \mathrm { H F } } ^ { T } \| _ { 2 } ^ { 2 } \right)
$$

with weights $\alpha , \beta \in [ 0 , 1 ]$ . To optimize over the special orthogonal group $S O ( N _ { \mathrm { o } } )$ , we use the Cayley transform (Gallier, 2013). App. C further details the procedure.

# 4.4 Generalizing over systems

We now focus on generalizing the construction of our Pfaffian wave function for different systems. We accomplish the generalization similar to PESNet (Gao & Günnemann, 2022) by introducing a second neural network, the MetaGNN $\mathcal { M } : ( \mathbb { R } ^ { 3 } \times \mathbb { N } _ { + } ) ^ { N _ { \mathrm { n } } }  \Theta$ that acts upon the molecular structure, i.e., nuclei positions and charges, and parametrizes the electronic wave function $\Psi _ { \mathrm { P f a f f i a n } } : \mathbb { R } ^ { N _ { \mathrm { e } } \times 3 } \times \Theta  \mathbb { R }$ for the system of interest. As architecture for the wave function and MetaGNN, we use the same architecture as in Gao et al. (2023a) with the exception being that we replace the Slater determinant with the Pfaffian as described in Sec. 4 and minor tweaks highlighted in App. D.4.

Pfaffian. To represent wave functions of different systems within a single NeurPf, we need to adapt the orbitals $\hat { \Phi } _ { \mathrm { P f } }$ and antisymmetrizer $A _ { \mathrm { P f } }$ from Eq. (12) to the molecule. In doing so, we must ensure $N _ { \mathrm { o } } \geq \operatorname* { m a x } \{ N _ { \uparrow } , N _ { \downarrow } \}$ . Otherwise, $\hat { \Phi } _ { \mathrm { P f } } A _ { \mathrm { P f } } \hat { \Phi } _ { \mathrm { P f } } ^ { T }$ is singular, and the wave function is zero. One may solve this by picking $N _ { \mathrm { o } }$ large enough that $N _ { \mathrm { o } } \geq \operatorname* { m a x } \{ N _ { \uparrow } , N _ { \downarrow } \}$ for all molecules in the dataset. However, this is computationally expensive, does not reuse known orbitals in the problem, and simply moves the problem to even larger systems. Instead, we grow the number of orbitals $N _ { \mathrm { o } }$ with the system size by defining $N _ { \mathrm { o r b / n u c } }$ orbitals per nucleus, as depicted in Fig. 2. This allows us to transfer orbitals from smaller systems to larger systems. We only need to ensure that $N _ { \mathrm { o r b / n u c } }$ is larger than half the maximum number of electrons in a period, e.g., for the first period $N _ { \mathrm { o r b / n u c } } \geq 1$ , for the second period $N _ { \mathrm { o r b / n u c } } \geq 5$ .

The projection $W$ from Eq. (14) and the envelope decays $\sigma$ are parametrized by node embeddings, while the envelope weights $\pi$ and the antisymmetrizer $A _ { \mathrm { P f } }$ are derived from edge embeddings. We predict a $N _ { \mathrm { o r b / n u c } } \times N _ { \mathrm { f } }$ matrix per nucleus for $W$ and a $N _ { \mathrm { e n v / n u c } }$ vector per nucleus for $\sigma$ . For the edge parameters $\pi$ and $A _ { \mathrm { P f } }$ , we predict a $N _ { \mathrm { e n v / n u c } } \times N _ { \mathrm { o r b / n u c } }$ and a $N _ { \mathrm { o r b / n u c } } \times N _ { \mathrm { o r b / n u c } }$ matrix per edge, respectively. These are concatenated into the $N _ { \mathrm { e n v } } \times N _ { \mathrm { o } }$ and $N _ { \mathrm { o } } \times N _ { \mathrm { o } }$ matrices $\pi$ and $\hat { A } _ { \mathrm { P f } }$ . The latter is antisymmetrized to get $\begin{array} { r } { A _ { \mathrm { P f } } = \frac { 1 } { 2 } ( \hat { A } _ { \mathrm { P f } } - \hat { A } _ { \mathrm { P f } } ^ { T } ) } \end{array}$ . We parametrize the spin-dependent scalars $\eta$ as node outputs for a fixed number of spin configurations $N _ { \mathrm { s } }$ . Because the change in spin configuration does not grow with system size, $N _ { \mathrm { s } }$ is fixed. We generate two sets of these parameters, on for $\Phi _ { \mathrm { P f } }$ and on for $\tilde { \Phi } _ { \mathrm { P f } }$ . App. D provides definitions for the wave function, the MetaGNN, and the parametrization.

![](images/cf2af261cf840422da61c1244973da1a85a6f0c529f1dea14a5f93603e6428b7.jpg)  
Fig. 2: Orbital parametrization per nucleus. , $\bigcirc \infty$ indicate electrons and nuclei, respectively.

Pretraining. Previous work like Gao & Günnemann (2023a) needed to canonicalize the Hartree-Fock solutions for different systems before pretraining to ensure that the orbitals fit the neural network. Alternatively, Scherbela et al. (2023) relied on traditional quantum chemistry methods like Foster & Boys (1960)’s localization to canonicalize their orbitals in conjunction with sign equivariant neural networks. In contrast, we ensure that the transformed Hartree-Fock orbitals are similar across structures as we optimize $T \in S O ( N _ { \mathrm { o } } )$ and $A _ { \mathrm { H F } } \in \mathbb { S }$ for each structure separately, which simultaneously also accounts for arbitrary rotations in the orbitals produced by Hartree-Fock.

Limitations. While our Pfaffian-based generalized wave function significantly improves accuracy on organic chemistry, we leave the transfer to periodic systems for future work (Kosmala et al., 2023). Further, due to the lac of low-level hardware/software support for the Pfaffian and the increased number of orbitals $N _ { \mathrm { o } } \geq \operatorname* { m a x } \{ N _ { \uparrow } , N _ { \downarrow } \}$ , our Pfaffian is slower than a comparably-sized Slater determinant. While we solve the issue of enforcing the fermionic antisymmetry, our neural wave functions are still unaware of any symmetries of the wave function itself. These are challenging to describe and largely unknown, but their integration may improve generalization performance (Schütt et al., 2018). Finally, in classical single-structure calculations, NeurPf may not improve accuracies. App. P discusses the broader impact of our work.

# 5 Experiments

In the following, we evaluate NeurPf on several atomic and molecular systems by comparing it to Globe (Gao & Günnemann, 2023a) and TAO (Scherbela et al., 2024). Concretely, we investigate the following: (1) Second-row elements and their ionization potentials and electron affinities. Globe cannot compute these due to its restriction to singlet state systems. (2) The challenging nitrogen potential energy surface where Globe significantly degraded performance when enlarging their training set with additional molecules. (3) The TinyMol dataset (Scherbela et al., 2024) to evaluate NeurPf’s generalization capabilities across biochemical molecules. In interpreting the following results, one should mind the variational principle, i.e., lower energies are better for neural wave functions. Further, $1 \mathrm { k c a l m o l ^ { - 1 } { \approx } 1 . 6 m } E _ { \mathrm { h } } ^ { \cdot }$ is the typical threshold for chemical accuracy.

Like previous work, we optimize the neural wave function using the VMC framework from Sec. 2. We precondition the gradient with the Spring optimizer (Goldshlager et al., 2024). App. E details the setup further. App. F,I and J show an experiment on extensity and additional ablations.

Atomic systems and spin configurations. We evaluate NeurPf on second-row elements and their ionization potentials and electron affinities. These systems are particularly interesting as they represent a wide range of spin configurations. We cannot use Globe on such systems because they differ from the singlet state assumption. Instead, we compare our results to the single-structure calculations from Pfau et al. (2020)’s FermiNet and the exact results from Chakravorty et al. (1993); Klopper et al. (2010). In App. G, we repeat this experiment for metals.

![](images/f156b32859e8dea84eba4ab9d73359b88ac3bd135e2b0617ce49ff0a1ba4ce05.jpg)  
Fig. 3: Ground state, electron affinity, and ionization potential errors of second-row elements during training. A single NeurPf has been trained on all systems jointly while references (Pfau et al., 2020) were calculated separately for each system. Energies are averaged over the last $10 \%$ of steps.

Fig. 3 displays the ground state energy, electron affinity, and ionization potential errors of NeurPf during training compared to the reference energies from Pfau et al. (2020); Chakravorty et al. (1993); Klopper et al. (2010). It is apparent that NeurPf reaches chemical accuracy relative to the exact results while only training a single neural network for all systems. While separately optimized FermiNets may achieve lower errors, Pfau et al. (2020) trained 21 neural networks for 200k steps each compared to a single NeurPf trained for 200k steps, i.e., 21 times fewer steps and samples. Whereas Gao & Günnemann (2023a); Scherbela et al. (2023) focus on singlet state systems or stable biochemical molecules, NeurPf demonstrates that a generalized wave function need not be restricted to such simple systems and can even generalize to a wide range of electronic configurations.

Effect of uncorrelated data. Next, we evaluate NeurPf on the nitrogen potential energy surface, a traditionally challenging system due to its high electron correlation effects (Lyakh et al., 2012). This is particularly interesting as Gao & Günnemann (2023a) observed a significant accuracy degradation when reformulating their wave function to generalize over different systems. In particular, they found that training only on the nitrogen dimer leads to significantly lower errors than training with an ethene-augmented dataset, indicating an accuracy penalty in generalization. We replicate their setup and compare the perfor

![](images/75b560dac353b2e5160daf07c13740b13a64a76a7113ebe6bc75269884aa696e.jpg)  
Fig. 4: Potential energy surface of nitrogen. Energies are relative to Le Roy et al. (2006).

mance of NeurPf trained on the nitrogen energy surface with and without additional ethene structures. Like Gao & Günnemann (2023a), the nitrogen structures are taken from Pfau et al. (2020) and the ethene structures from Scherbela et al. (2022). As additional references, we plot Gao & Günnemann (2022)’s PESNet and Fu et al. (2023)’s FermiNet results.

Fig. 4 shows the error potential energy surface relative to the experimental results from Le Roy et al. (2006). NeurPf reduces the average error on the energy surface from Globe’s $2 . 7 \mathrm { m } E _ { \mathrm { h } }$ to $2 \mathrm { m } E _ { \mathrm { h } }$ when training solely on nitrogen structures. When adding the ethene structures, Globe’s error increases to $5 . 3 \mathrm { m } E _ { \mathrm { h } }$ while NeurPf’s error stays constant at $2 \mathrm { m } E _ { \mathrm { h } }$ , a lower error than the Globe without the augmented dataset. These results indicate NeurPf’s strong capabilities in approximating ground states while allowing for generalization across different systems without a significant loss in accuracy.

TinyMol dataset. Finally, we look at learning a generalized wave function over different molecules and structures. We use the TinyMol dataset (Scherbela et al., 2024), consisting of a small and large dataset. The dataset includes ‘goldstandard’ CCSD(T) CBS energies. The small set consists of 3 molecules with 2 heavy atoms, while the large set covers 4 molecules with 3 heavy atoms. For each molecule, 10 structures are provided. Here, we compare again both Globe $\left( + \mathbf { M o o n } \right)$ and TAO to NeurPf. All models are directly trained on the small and large test sets.

Fig. 5 shows the mean energy difference to CCSD(T) at different stages of the training. We refer to App. K for a per molecule error attribution. It is apparent that NeurPf yields lower errors than the TAO and Globe after at least 500 steps. On the small structures, NeurPf even matches the CCSD(T) baseline after 16k steps and achieves $1 . 9 \mathrm { m } E _ { \mathrm { h } }$ lower energies after $3 2 \mathbf { k }$ steps. Since VMC methods are variational, i.e., lower energies are always better, NeurPf is more accurate than the CCSD(T) CBS reference. Compared to TAO and Globe, NeurPf reports $5 . 9 \mathrm { m } E _ { \mathrm { h } }$ and $1 1 . 3 \mathrm { m } E _ { \mathrm { h } }$ lower energies, respectively. On the large structures, we observe a similar pattern where we find NeurPf having a 25 times smaller error than TAO during the early stages of training and reaching $2 1 . 1 \mathrm { m } E _ { \mathrm { h } }$ lower energies after 32k steps – a 6 times lower error compared to the CCSD(T) baseline. Note that since the CCSD(T) (CBS) energies are neither exact nor variational, the true error to the ground state is unknown. Still, we provide additional numbers for a NeurPf trained for $1 2 8 \mathrm { k \Omega }$ steps in App. K. There, we find NeurPf yielding $4 . 4 \mathrm { m } E _ { \mathrm { h } }$ lower energies on the large structures. These results show that a generalized wave function can achieve high accuracy on various molecular structures without pretraining when not relying

![](images/67aa0406dbac62db8246e2f2d27360229fa40d9c2efbb2d25cfe36a06e10356f.jpg)  
Fig. 5: Convergence of mean energy difference on the TinyMol dataset from Scherbela et al. (2024). The y-axis is linear $< 1$ and logarithmic $\geq 1$ . Due to the variational principle, NeurPf is better than the reference CCSD(T) on the small molecules.

on hand-crafted algorithms or Hartree-Fock calculations. For additional experiments, we refer the reader to App. L where we first pretrain TAO and NeurPf on a separate training set and, then, finetune on the small and large test sets and App. M for a comparison of joint and separate optimization.

# 6 Conclusion

In this work, we established a new way of parametrizing neural network wave functions for generalization across molecules via overparametrization with Pfaffians. Our Neural Pfaffian is more accurate, simpler to implement, fully learnable, and applicable to any molecular system compared to previous work. The wave function changes smoothly with the structure, avoiding the discrete orbital selection problem previously solved via hand-crafted algorithms or Hartree-Fock. Additionally, we introduced a memory-efficient implementation of the exponential envelopes, reducing memory requirements while accelerating convergence. Further, we presented a pretraining scheme for Pfaffians enabling initialization with Hartree-Fock – a crucial step for molecular systems. Our experimental evaluation demonstrated that our Neural Pfaffian can generalize across different ionizations of various systems, stay accurate when enlarging datasets, and set a new state of the art by outperforming previous neural wave functions and the reference CCSD(T) CBS on the TinyMol dataset. These developments open the door for new neural wave functions applications, e.g., to generate reference data for machine-learning force fields or density functional theory (Cheng et al., 2024; Gao et al., 2024).