# MjoÂ¨lnir: Breaking the Shield of Perturbation-Protected Gradients via Adaptive Diffusion

Xuan Liu1, Siqi $\mathbf { C a i } ^ { 2 }$ , Qihua Zhou3, Song $\mathbf { G u o ^ { 4 ^ { * } } }$ , Ruibin $\mathbf { L i } ^ { 1 }$ , Kaiwei Lin2

1The Hong Kong Polytechnic University, Hong Kong 2Hubei Key Laboratory of Transportation Internet of Things, Wuhan University of Technology, Wuhan, China 3College of Computer Science and Software Engineering, Shenzhen University, Shenzhen, China 4Department of Computer Science and Engineering, The Hong Kong University of Science and Technology, Hong Kong xuan18.liu $@$ connect.polyu.hk, csiqi $@$ whut.edu.cn, qihuazhou $@$ szu.edu.cn, songguo $@$ cse.ust.hk ruibin.li $@$ connect.polyu.hk, $2 9 7 6 6 2 @$ whut.edu.cn

# Abstract

Perturbation-based mechanisms, such as differential privacy, mitigate gradient leakage attacks by introducing noise into the gradients, thereby preventing attackers from reconstructing clientsâ€™ private data from the leaked gradients. However, can gradient perturbation protection mechanisms truly defend against all gradient leakage attacks? In this paper, we present the first attempt to break the shield of gradient perturbation protection in Federated Learning for the extraction of private information. We focus on common noise distributions, specifically Gaussian and Laplace, and apply our approach to DNN and CNN models. We introduce MjoÂ¨lnir, a perturbation-resilient gradient leakage attack that is capable of removing perturbations from gradients without requiring additional access to the original model structure or external data. Specifically, we leverage the inherent diffusion properties of gradient perturbation protection to develop a novel diffusion-based gradient denoising model for MjÂ¨olnir. By constructing a surrogate client model that captures the structure of perturbed gradients, we obtain crucial gradient data for training the diffusion model. We further utilize the insight that monitoring disturbance levels during the reverse diffusion process can enhance gradient denoising capabilities, allowing MjÂ¨olnir to generate gradients that closely approximate the original, unperturbed versions through adaptive sampling steps. Extensive experiments demonstrate that MjoÂ¨lnir effectively recovers the protected gradients and exposes the Federated Learning process to the threat of gradient leakage, achieving superior performance in gradient denoising and private data recovery.

# Introduction

Federated Learning (FL) is a distributed machine learning paradigm that facilitates collaborative model training without directly transmitting raw training data. Instead, it aggregates gradients or parameters shared among clients to build a global model (McMahan et al. 2017; Gong et al. 2024; Wu et al. 2023; Zhang et al. 2024). This approach preserves the privacy of raw data by keeping it within its originating domain, addressing concerns associated with traditional centralized data processing. However, FL is vulnerable to gradient inversion attacks (Geng et al. 2023; Liu et al. 2023; Zhu,

![](images/0d5b511637b801b391b8d47958038b65cdd7a3d6fc8c1b4c5b6348f757d43566.jpg)  
Figure 1: Threat model. The FL training process is threatened by gradient leakage attacks, where the attacker can intercept the exchanged gradients $\boldsymbol { \nabla } W$ to recover the private training data. Previous work often protects the gradients by injecting perturbation into the gradients to form $\nabla W _ { N } ^ { \prime }$ and âˆ‡W P rotect. Our MjoÂ¨lnir removes the perturbation injected in the protected gradients via the adaptive diffusion process.

Liu, and Han 2019), in which adversaries can potentially reconstruct sensitive user data from the shared gradients. This vulnerability has spurred significant research into gradient protection techniques (Tan et al. 2024a; RodrÂ´Ä±guez-Barroso et al. 2023). Gradient Perturbation, such as differential privacy (DP), injecting noise into gradients to enhance privacy, has been proven to be an effective strategy for safeguarding data in FL scenarios (Wei et al. 2020; Ouadrhiri and Abdelhadi 2022; Wang, Hugh, and Li 2024).

Perturbation-based gradient protection achieves its goal by adding noise to the gradients. If a method is developed to eliminate this noise effectively, the protective mechanism of this approach becomes ineffective. Diffusion Model (Ho, Jain, and Abbeel 2020; Gong 2023) has the natural applicability to denoising the perturbation and is a potential approach to attack perturbation-based gradient protection. We hold the above idea based on two points: 1) Considering that gradient is the result of linear transformations applied to the training data, such as image data, we posit that if the original data are stable and predictable, then the corresponding gradient data will also be stable and predictable. 2) The essence of gradient perturbation protection is akin to the diffusion process applied to inherently structurally stable gradient data.

In this paper, we present the first attempt to break the shield of gradient perturbation protection in FL based on the diffusion model. We reveal the natural diffusion properties of gradient perturbation protection and propose $\mathbf { \bar { M j } } \mathbf { \bar { o l n i r } } ^ { 1 }$ , a perturbation-resilient gradient leakage attack method and the first general gradient diffusion attack (schematic diagram shown in Fig. 2) that is capable of rendering various kinds of perturbations on gradients (e.g. Differential Privacy (Truex et al. 2020), certain layer representation perturbation (Sun et al. 2021), dynamic perturbation (Wei et al. 2021)) nearly invalid. As the first attempt, we focus on common noise distributions, specifically Gaussian and Laplace, and apply our approach to DNNs and CNNs. Our method involves constructing a surrogate model for the target attack model to obtain protected shared gradients. In the absence of the original model structure and third-party datasets, we use the surrogate gradient data supply model to generate training data for our gradient diffusion model. This trained gradient diffusion model allows us to approximate the original shared gradients from the perturbed, privacy-preserving gradients obtained by attackers. MjoÂ¨lnir integrates the perturbation protection mechanism into the reverse diffusion process, adjusting the privacy-preserving gradient denoising nodes and regulating the diffusionâ€™s forward and reverse time steps with the perturbation level $M$ as an adaptable parameter.

In summary, our key contributions include:

â€¢ We disclose the natural diffusion process in general gradient perturbation mechanisms and introduce a perturbation adaptive parameter $M$ to adaptively adjust the diffusion step size according to the degree of perturbation. â€¢ We propose MjoÂ¨lnir, the first practical gradient diffusion attack strategy to recover the perturbed gradients, without additional access to the original model structure and third-party data, which breaks the bottleneck that existing gradient leakage attacks cannot effectively leak privacy under gradient perturbation protection. â€¢ We demonstrate the vulnerability of gradient perturbation protection under the MjoÂ¨lnir adaptive diffusion denoising process. Experimental results under the general perturbation protection FL system show that MjoÂ¨lnir achieves the best gradient denoising quality and privacy leakage ability on commonly used image datasets.

# Background and Related Work FL with Perturbation Protection (FL-PP)

FL-PP includes a variety of alternative gradient perturbation techniques, such as adding random global noise to gradients, noise to specific layers, and dynamic noise addition (Zhang et al. 2022). Among these, FL with Differential Privacy (FLDP) is the most widely used method (Shi et al. 2022; Chen et al. 2023; Tan et al. 2024b).

Generally, DP is defined based on the concept of adjacent database and has been applied in various practical areas in Artificial Intelligence to protect privacy information through adding specific perturbation, e.g., Googleâ€™s RAPPORT (Erlingsson, Pihur, and Korolova 2014) and largescale graph data publishing (Ding et al. 2021). FL-DP protects the shared model parameters or gradients between clients and the server during the FL training process by applying Local Differential Privacy (LDP (Zhao et al. 2021; Truex et al. 2020)) and (or) Differential Privacy Stochastic Gradient Descent algorithm (DPSGD (Abadi et al. 2016; Zhou et al. 2023)). In this paper we discuss both $\varepsilon - D P$ and $( \varepsilon , \delta ) - D P$ (Dwork et al. 2006a,b; Abadi et al. 2016) as our sample attack background (Shi et al. 2022; Chen et al. 2023; Tan et al. 2024b):

Assumption $\scriptstyle  I .$ . A randomized mechanism $M \colon D \ \to \ R$ with domain $D$ and range $R$ satisfies $\varepsilon$ - differential privacy if for any two adjacent inputs d $, d ^ { \prime } \in D$ and for any subset of outputs $S \subseteq R$ , and it holds that:

$$
P r [ M ( d ) \in S ] \leq e ^ { \varepsilon } P r [ M ( d ^ { \prime } ) \in S ]
$$

Assumption 2. A randomized mechanism $M \colon D \ \to \ R$ with domain $D$ and range $R$ satisfies $( \varepsilon , \delta )$ - differential privacy if for any two adjacent inputs $d$ $\iota , d ^ { \prime } \in D$ and for any subset of outputs $S \subseteq R$ , and it holds that:

$$
P r [ M ( d ) \in S ] \leq e ^ { \varepsilon } P r [ M ( d ^ { \prime } ) \in S ] + \delta
$$

$\delta$ -approximation is preferably smaller than $1 / | d |$ . We usually apply Laplace perturbation for the definition in Eq. (1). However, as to the definition in Eq. (2), the noise perturbation mechanism needs to be Gaussian Mechanisms, which can adapt both $\varepsilon$ and $\delta$ . Refer to Theorem A.1 in Gaussian Mechanisms (Dwork and Roth 2014), with $\begin{array} { r l } { \nabla s } & { { } = } \end{array}$ $m a x _ { D , D ^ { \prime } } | | S ( D ) - S ( D ^ { \prime } ) | |$ (s is the real-value function) and $c _ { d p }$ denotes the hyperparameter used to define the DP boundary, to ensure Gaussian noise distribution $N ( 0 , \sigma _ { d p } ^ { 2 } )$ well preserves $( \varepsilon , \delta ) - D P$ , the noise scale should satisfy:

$$
\begin{array} { r c l } { { \sigma _ { d p } } } & { { \geq } } & { { c _ { d p } \nabla s / \varepsilon , \quad \varepsilon \in ( 0 , 1 ) } } \\ { { c _ { d p } } } & { { \geq } } & { { \sqrt { 2 l n ( 1 . 2 5 / \delta ) } } } \end{array}
$$

Taking the local participates site for example, the main actions for FL-DP can be divided into four steps: setting DP noise mechanism, local gradient clipping, local gradient perturbation, and uploading the protected parameters to the server (Wei et al. 2020). FL involves multiple participants, making composition theorem in DP necessary when applying noise. Among the composition DP methods available, including Simple Composition, Advanced Composition (Dwork and Roth 2014), and Moments Accountant (Abadi et al. 2016), we utilize Simple Composition for the following discussion. In the case where $M _ { i }$ satisfies $( \varepsilon , \delta ) - D P$ , the composition $( M _ { 1 } , M _ { 2 } , \cdots , M _ { k } )$ satisfies $( \sum _ { i = 1 } ^ { k } \varepsilon _ { i } , \sum _ { i = 1 } ^ { k } \delta _ { i } )$ alA. i2g0n2i0n;gDwitohrkthet astl.at2e-0o0f6-a,rtb FALb-aDdPi et al. 2016; Shi et al. 2022; Chen et al. 2023; Tan et al. 2024b), We applied the following assumptions for noise calculation in local client gradient perturbation, considering both $\varepsilon$ -DP (using the Laplace mechanism) and $( \varepsilon , \delta )$ -DP (using the Gaussian mechanism):

$$
\begin{array} { r c l } { L a p l a c e : \sigma _ { d p c } } & { = } & { \nabla s _ { c } \times 1 / \varepsilon } \\ { G a u s s i a n : \sigma _ { d p c } } & { = } & { \nabla s _ { c } \times \sqrt { 2 l n ( 1 . 2 5 / \delta ) } / \varepsilon } \end{array}
$$

where $\nabla s _ { c }$ is the sensitivity and can be formulated as $\nabla s _ { c } =$ $\textstyle { \frac { 2 C } { m } }$ . $C$ is the clipping threshold for bounding $| | \nabla W _ { i } | | \le C$ , where $\nabla W _ { i }$ denotes the unperturbed gradient from the $\displaystyle i - t h$ client and $m$ denotes the minimum size of local datasets.

# Gradient Inversion Attack (GradInv)

GradInv is a prevalent method in gradient leakage attacks and aims to steal the clientâ€™s privacy information in the FL system. The primary idea for the majority of GradInv to recover original information is minimizing the distance between the dummy gradient $\nabla W _ { \xi }$ and the original gradient $\nabla W$ while updating the random data $x _ { \xi }$ and label $y _ { \xi }$ until the optimized results $\nabla W _ { \xi } ^ { * }$ and $( x _ { \xi } ^ { * } , y _ { \xi } ^ { * } )$ are close enough to the original ones. The key formulation can be described as:

$$
m i n | | \nabla W _ { \xi } - \nabla W | | : ( x _ { \xi } , y _ { \xi } ) \to ( x _ { \xi } ^ { * } , y _ { \xi } ^ { * } )
$$

Previous works utilize Peak Signal-to-Noise Ratio (PSNR) of the recovered images to evaluate the performance of GradInv, with the threshold for the success of such attacks typically hinging on the degree of detail discernible to the human eye in the reconstructed private images (Geiping et al. 2020; Zhu, Liu, and Han 2019; Liu et al. 2023).

# Methodology

MjoÂ¨lnir is the first Diffusion Attack Method focusing on the gradient data structure that can be applied to multiple kinds of gradient perturbation protection in FL through adaptive parameters setting on both forward and reverse process of the Gradient Diffusion Model employed in MjoÂ¨lnir. The threat models targeted by MjoÂ¨lnir encompass various forms of gradient perturbation. Meanwhile, the extremely similar noise mechanism on gradient perturbation protection and diffusion Markovian process provides a mathematical necessity for MjoÂ¨ lnir to realize an efficient privacy attack on gradient perturbation protection. Overall, our MjoÂ¨lnir method (shown in Fig. 2) can be summarized in four steps:

Step (1) Get Protected Gradients. Honest-but-curious malicious attackers steal the Shared Perturbed Gradients $\nabla W ^ { \prime }$ during the FL training process by hiding on the server side or waiting on the way of parameter sharing (Fig.1).

<html><body><table><tr><td>Algorithm1: Gradients Extracted forMjolnir Training</td></tr><tr><td>1:Stolen Protected Gradients:Fi â†’VW';</td></tr><tr><td>2:Construct surrogate Model: VW'â†’Fs;</td></tr><tr><td>3:j=0;âˆˆ~ N(0,I);</td></tr><tr><td>4: for iteration =1to Lengthrandomdataset do</td></tr><tr><td>5: VWj =âˆ‚l(Fs(xj;Ws),yj)/aWs;</td></tr><tr><td>6: Save VWj;</td></tr><tr><td>7: j=j+1;</td></tr></table></body></html>

Step (2) Construct Surrogate Model. Construct Surrogate Gradients Data Supply Model $F ^ { s }$ from the data structure of Shared Perturbed Gradients $\nabla W ^ { \prime }$ stolen by the attacker that can output the same gradient data structure as the target attacked clientâ€™s local model (Algorithm 1, Fig. 2).

Before delving into Step (3) and Step (4), two configurations that recur in the subsequent steps are defined:

Perturbed Gradient Surrogate Model Feed Random ðœµð‘¾â€²ð‘³ð’‚ð’šð’†ð’“ ðŸ ð‘­ð’”ð‘³ð’‚ð’šð’†ð’“ ðŸ Surrogate GIrmadaigeentDataset ðœµð‘¾â€² ðœµð‘¾â€²ð‘³ð’‚ð’šð’†ð’“ ðŸ ð‘­ð’” ð‘³ð’‚ð’šð’†ð’“ ðŸ ðœµð‘¾ð’”ð‘³ð’‚ð’šð’†ð’“ ðŸ   
Size = L Construct Extract ðœµð‘¾ð’”ð‘³ð’‚ð’šð’†ð’“ ðŸ L ðœµð‘¾â€²ð‘³ð’‚ð’šð’†ð’“ ð‘µ 2 1 P ð‘­ð’”ð‘³ð’‚ð’šð’†ð’“ ð‘µ ðœµð‘¾ð’”ð‘³ð’‚ð’šð’†ð’“ ð‘µ P   
Padding ð’ˆ L ð’ˆ   
Size = P 4 Inference ðœµð‘¾ð‘º ð’ˆ Gradient Diffusion Model Train ð‘¿ðŸŽ\~ð’‘(ð‘¿|ðœµð‘¾â€²) ð‘¿ð’•âˆ’ðŸ ð‘¿ð’• ð‘¿ \~ð(ðŸŽ, ðˆ) PZPT ðª(ð‘¿ð’• |ð‘¿ð’•âˆ’ðŸ)   
ðœµð‘¾ð‘¹ ç» ð’‘ (ð‘¿ |ð‘¿ , ðœµð‘¾â€²)

[Gradient Adjustment]: Gradients each with total size $L$ $( L = L _ { \nabla W _ { L a y e r 1 } } + L _ { \nabla W _ { L a y e r 2 } } + . . . + L _ { \nabla W _ { L a y e r N } } )$ are adjusted into $1 \times g \times g ( g ^ { 2 } = L + P ; g = \operatorname { r }$ minimum integer satisfies $g ^ { 2 } > L$ ; $P = 0$ -padding size) before feeding into Gradient Diffusion Model for training or inference to adapt gradient diffusion process. The adjustment is only related to Diffusion procedures, gradients are restored to their original structure and size before further Gradient-Based Attacks and Evaluations.

[M-Adaptive Process]: Adaptive parameter $M$ is inserted into $\nabla W ^ { \prime }$ before inference to ensure the starting time step is appropriately positioned to maximize the denoising capability of Gradient Diffusion Model (Eq. (14) $\sim$ Eq. (16)).

Step (3) Train Gradients Diffusion Model. Construct

# Algorithm 2: Gradient Diffusion Model Training

<html><body><table><tr><td>1: if With Condition VW' then Xo = (VW',VWj); 2: else Xo = VWj; 3:Repeat: 4: Xo~p(Xo);t~Uniform(1â†’T);âˆˆ~N(0,I); 5: Takea gradient descent step on:Velle - fe(âˆštXo+ âˆš1-Ytâˆˆ,t)llÂ²; 6:until converged;</td></tr></table></body></html>

![](images/a16ec3004a1743038047db86e3c44cb17625c98b2f283aae3a7320860473f37c.jpg)  
Figure 3: Visualization of Markovian gradient diffusion process. $M$ is the noise scale of perturbation, which is set as the adaptive parameter in [M-Adaptive Process]. MjoÂ¨lnir Train and MjoÂ¨lnir Inference correspond to Algorithm 2 and Algorithm 3 respectively.

our Gradient Diffusion Model that takes into account the level of knowledge about the attacked model (e.g., whether the level of perturbation noise or the type of noise is known). Conduct [Gradient Adjustment] to Clean Gradients $\nabla W ^ { s }$ extracted from Surrogate Model $F ^ { s }$ to build a training gradient dataset to train our Gradient Diffusion Model (Fig. 2, Fig.3). Algorithm 2 demonstrates a detailed training process. Step (4) Recover Original Gradients. The stolen Shared Perturbed Gradients $\nabla W ^ { \prime }$ are put into our trained MjoÂ¨lnir Gradient Diffusion Model after [Gradient Adjustment] and [M-Adaptive Process] to generate the Recovered Gradients $\nabla W ^ { R }$ for further Gradient-Based Attack to get certain privacy information based on various demands (Algorithm 3, Fig. 2 and Fig. 3).

Algorithm 3: Generate Original Gradient   

<html><body><table><tr><td>1:if Known Noise Scale M then c 1</td></tr><tr><td>2:else c âˆˆ(0,1); V1+M2;</td></tr><tr><td>3: Xt ~ cVW';</td></tr><tr><td>4: for t = T.',..,1 do</td></tr><tr><td>5: if t >1 then z~ N(0,I);</td></tr><tr><td>6: elsez=0;</td></tr><tr><td>7: Xt-1= (Xt--fe(Xt,t))+âˆš1-atz; âˆšat</td></tr><tr><td>8: return Xo; VWR â† Xo: >ForFurther GradInv;</td></tr></table></body></html>

MjoÂ¨lnirâ€™s Gradient Diffusion Model is inspired by DDPM(Ho, Jain, and Abbeel 2020), to be specific:

In Step (3) Train Gradients Diffusion Model, refer to Algorithm 2 lines 4 to 6, we set $t \in ( 1 , T )$ as the time steps of Gaussian noise addition. $T$ is the total time step of the forward Markovian diffusion process. $\alpha _ { t } ( 0 < \alpha _ { t } < 1 )$ ] denote the adaptive variables at each iteration and $\gamma _ { t } \mathrm { ~ = ~ }$ $\textstyle \prod _ { t = 0 } ^ { t } \alpha _ { t }$ . With the above settings, the forward process $( q ;$ : with no learnable parameters) of MjÂ¨olnirâ€™s Gradients Diffusion Model can be modeled as:

$$
\begin{array} { r c l } { q ( X _ { 1 } | X _ { 0 } ) } & { = } & { N ( X _ { 1 } ; \sqrt { \alpha _ { 1 } } X _ { 0 } , ( 1 - \alpha _ { 1 } ) I ) } \\ { q ( X _ { t } | X _ { 0 } ) } & { = } & { N ( X _ { t } ; \sqrt { \gamma _ { t } } X _ { 0 } , ( 1 - \gamma _ { t } ) I ) } \end{array}
$$

Given $( X _ { 0 } , X _ { t } )$ , $X _ { t - 1 }$ can be modeled as:

$$
q ( X _ { t - 1 } | X _ { 0 } , X _ { t } ) = N ( X _ { t } ; \mu _ { t } , \sigma _ { t } I )
$$

If insert the stolen Shared Perturbed Gradients $\nabla W ^ { \prime }$ or constructed Surrogate Perturbed Gradients $\nabla W _ { p e r t u r b e d } ^ { s }$ training condition then input $X _ { 0 } ~ = ~ ( c o n d i t i o n , \nabla W _ { j } )$ .If not to train with the condition, then input $\begin{array} { r l } { X _ { 0 } } & { { } = } \end{array}$ $\nabla W _ { j }$ .Through algebraic calculation, $\mu _ { t }$ and $\sigma _ { t }$ in Eq. (10) can be simplified for further usage in the reverse training process(Saharia et al. 2023) as:

$$
\begin{array} { r c l } { \mu _ { t } } & { = } & { \displaystyle \frac { \sqrt { \gamma _ { t - 1 } } ( 1 - \alpha _ { t } ) } { 1 - \gamma _ { t } } X _ { 0 } + \frac { \alpha _ { t } ( 1 - \gamma _ { t - 1 } ) } { 1 - \gamma _ { t } } X _ { t } } \\ { \sigma _ { t } ^ { 2 } } & { = } & { \displaystyle \frac { 1 - \gamma _ { t - 1 } } { 1 - \gamma _ { t } } ( 1 - \alpha _ { t } ) } \end{array}
$$

In the reverse process $( p )$ of MjoÂ¨ lnirâ€™s Gradient Diffusion training, the objective function $f _ { \theta }$ which is trained to predict noise vector $\epsilon$ is modeled as:

$$
E _ { X _ { 0 } , \epsilon } [ \frac { ( 1 - \alpha _ { t } ) ^ { 2 } } { 2 \sigma _ { t } ^ { 2 } \alpha _ { t } ( 1 - \gamma _ { t } ) } | | f _ { \theta } ( \sqrt { \gamma _ { t } } X _ { 0 } + \sqrt { 1 - \gamma _ { t } } \epsilon , t ) - \epsilon | | ^ { 2 } ]
$$

In Step (4) Recover Original Gradients, refer to Algorithm 3, two different original gradient generation processes are chosen depending on whether or not attackers know the Noise Scale of Perturbation of the Threat Model. Take FL with Gaussian Differential Privacy (Eq. (6)) as an example, consider an experienced and clever attacker who may know the DP Privacy Budget $\varepsilon$ and the probability of information leakage $\delta$ ( $\delta$ is likely to be set as $1 \dot { 0 } ^ { - 5 }$ from usual practice in DP), combining with the sensitivity $\nabla { S }$ (which can be estimated if the attacker has some previous information with the target model training dataset), the noise scale can be calculated or estimated to an approximate value $M$ ( $M$ defined as the adaptive parameter in $/ M$ -Adaptive Process]). So, $\nabla W ^ { \prime }$ can be modeled as:

$$
\nabla W ^ { \prime } = \nabla W + M N ( 0 , I )
$$

Considering the forward Markovian gradient diffusion process in Step 3 Eq. (8) & Eq. (9), the relation between stolen perturbed gradients $\nabla W ^ { \prime }$ and original gradients $\nabla W$ can be remodeled as:

$$
{ \frac { 1 } { \sqrt { 1 + M ^ { 2 } } } } \nabla W ^ { \prime } = { \frac { 1 } { \sqrt { 1 + M ^ { 2 } } } } \nabla W + { \frac { M } { \sqrt { 1 + M ^ { 2 } } } } N ( 0 , I )
$$

Recall that our target is to generate $\nabla W ^ { R }$ , so $\scriptstyle { \frac { 1 } { \sqrt { 1 + M ^ { 2 } } } } \nabla W ^ { \prime }$ should be considered as $X _ { t }$ in the inverse process of Gradient Diffusion Model, while $\boldsymbol { \nabla } W$ stands for $X _ { 0 }$ .

Correspondingly, during the construction of the recovered gradient ${ \dot { \nabla } } W ^ { R }$ , the inverse time steps can be set as $T ^ { \prime }$ . The relationship between $T ^ { \prime }$ and $M$ is:

$$
{ \frac { 1 } { 1 + M ^ { 2 } } } = \prod _ { t = 0 } ^ { T ^ { \prime } } \alpha _ { t }
$$

Since $\begin{array} { r } { \gamma _ { t } \ = \ \prod _ { t = 0 } ^ { t } \alpha _ { t } } \end{array}$ have been predefined and calculated during t Qforward Markovian diffusion process, $T ^ { \prime }$ can be fixed in an approximate range $T ^ { \prime } \in ( T _ { - } ^ { \prime } , \mathbf { \bar { \it T } _ { + } ^ { \prime } } )$ , where $\begin{array} { r } { \prod _ { t = 0 } ^ { T _ { - } ^ { \prime } } \alpha _ { t } < \frac { 1 } { 1 + M ^ { 2 } } < \prod _ { t = 0 } ^ { T _ { + } ^ { \prime } } \alpha _ { t } } \end{array}$ and $T _ { - o r + } ^ { \prime }$ are positive integers less than the total forward noise addition time step $T$ . On the other hand, if $M$ can not be estimated, which means the attacker knows nothing about the noise scale. Since $\frac { 1 } { 1 + M ^ { 2 } } \ : \in \ : ( 0 , 1 )$ , the input value of the inference process can simply be set as $c \nabla W ^ { \prime }$ where $c \in ( 0 , 1 )$ to adapt the Markovian forward process.

<html><body><table><tr><td rowspan="2">Datasets</td><td rowspan="2">Model</td><td colspan="2">Îµ=1</td><td colspan="2">e=5</td><td colspan="2">Îµ=10</td></tr><tr><td>PSNRi</td><td>LRA</td><td>PSNRi</td><td>LRA</td><td>PSNRi</td><td>LRA</td></tr><tr><td rowspan="6">MINIST</td><td>GRNN(Ren, Deng, and Xie 2022)</td><td>14.70</td><td>1.000</td><td>16.54</td><td>1.000</td><td>20.19</td><td>1.000</td></tr><tr><td>IG(Geiping et al. 2020)</td><td>3.721</td><td></td><td>5.164</td><td></td><td>6.067</td><td></td></tr><tr><td>DLG(Zhu,Liu,and Han 2019)</td><td>0.222</td><td>0.676</td><td>8.025</td><td>0.752</td><td>17.08</td><td>0.909</td></tr><tr><td>Mjolnir</td><td>17.87</td><td>0.851</td><td>24.17</td><td>0.895</td><td>33.09</td><td>0.927</td></tr><tr><td>Mjolnir(Non-Adaptive)</td><td>17.39</td><td>0.851</td><td>24.14</td><td>0.889</td><td>32.98</td><td>0.925</td></tr><tr><td>Mjolnir(Conditional)</td><td>20.87</td><td>0.887</td><td>28.39</td><td>0.924</td><td>35.14</td><td>0.957</td></tr><tr><td rowspan="6">CIFAR100</td><td>GRNN(Ren, Deng, and Xie 2022)</td><td>18.24</td><td>1.000</td><td>20.61</td><td>1.000</td><td>21.15</td><td>1.000</td></tr><tr><td>IG(Geiping et al. 2020)</td><td>3.684</td><td></td><td>5.073</td><td></td><td>5.971</td><td></td></tr><tr><td>DLG(Zhu,Liu,and Han 2019)</td><td>0.112</td><td>0.769</td><td>7.673</td><td>0.833</td><td>18.57</td><td>0.896</td></tr><tr><td>Mjolnir</td><td>18.25</td><td>0.883</td><td>19.04</td><td>0.902</td><td>21.32</td><td>0.902</td></tr><tr><td>Mjolnir(Non-Adaptive)</td><td>18.15</td><td>0.871</td><td>17.98</td><td>0.884</td><td>21.06</td><td>0.891</td></tr><tr><td>Mjolnir(Conditional)</td><td>18.69</td><td>0.901</td><td>21.02</td><td>0.902</td><td>23.49</td><td>0.908</td></tr><tr><td rowspan="6">STL10</td><td>GRNN(Ren, Deng, and Xie 2022)</td><td>12.24</td><td>1.000</td><td>16.24</td><td>1.000</td><td>20.98</td><td>1.000</td></tr><tr><td>IG(Geiping et al. 2020)</td><td>4.323</td><td></td><td>6.082</td><td></td><td>7.851</td><td></td></tr><tr><td>DLG(Zhu,Liu,and Han 2019)</td><td>0.038</td><td>0.783</td><td>5.673</td><td>0.815</td><td>17.25</td><td>0.851</td></tr><tr><td>Mjolnir</td><td>12.36</td><td>0.806</td><td>16.30</td><td>0.857</td><td>19.77</td><td>0.889</td></tr><tr><td>Mjolnir(Non-Adaptive)</td><td>12.28</td><td>0.801</td><td>15.19</td><td>0.849</td><td>19.76</td><td>0.887</td></tr><tr><td>Mjolnir(Conditional)</td><td>12.98</td><td>0.816</td><td>20.30</td><td>0.872</td><td>22.77</td><td>0.906</td></tr></table></body></html>

Table 1: Privacy leakage capability of MjoÂ¨lnir variant models and traditional Gradients Leakage Attacks in FL-DP $( \delta = 1 0 ^ { - 5 }$ , $\varepsilon = 1$ , 5, 10). Gray marker: MjoÂ¨ lnir outperforms the highest result of traditional ones.

![](images/6db18d6b26a775a61c7d200695a90af8de57639b989f6a6721bb47dd134230d7.jpg)  
Figure 4: Comparison of the private image recovery procedures to the iterations between MjoÂ¨lnir variant models and traditional Gradient Leakage Attack methods (DLG (Zhu, Liu, and Han 2019)).

Also, if conditions allow, $c$ can be modeled and predicted by a separate Machine Learning model according to the specific requirement of attackers.

# Experiments

# Experimental Setups

(A) MjoÂ¨ lnir Variant Attack Models. MjoÂ¨ lnir (trained with only unperturbed surrogate gradients), Conditional MjoÂ¨lnir (trained with both perturbed gradients and unperturbed surrogate gradients), and Non-Adaptive MjoÂ¨lnir (without $I M \cdot$ - Adaptive Process]: no perturbation scale $M$ as an adaptive parameter during gradient diffusion process) are presented.

(B) Benchmarks and Datasets. We employ MNIST, CIFAR100, and STL10 as client privacy datasets, which also serve as the ground truth for privacy leakage evaluation. We extract the unperturbed original gradients $( \nabla W )$ of the aforementioned three datasets from the local training model of the target client as the reference benchmark of gradient denoising under the FL-PP paradigm. The MjoÂ¨lnir gradient diffusion model is trained with gradients extracted from a separate dataset, FashionMNIST.

(C) Evaluation and Boundary. To evaluate the Privacy Leakage Capability, we utilize the Image Average Peak Signal-to-Noise Ratio $P S N R _ { i }$ and the Label Recovered Accuracy $L R A$ . These metrics are employed to assess the fidelity of the recovered images and the accuracy of the recovered labels, respectively, to the original images and ground truth labels. The boundary of Privacy Leakage Attack is aligned with previous works: the attack is considered successful if human visual perception can discern the requisite information from the recovered images. In the context of evaluating Gradient Denoising, we employ the cosine similarity $C o s S i m i l a r _ { g }$ and the Average Peak Signal-to-Noise Ratio $P S N R _ { g }$ as metrics to assess the quality of the Recovered Gradients $\nabla W ^ { R }$ compared to the Original Gradients $\nabla W$ . Higher values of the two metrics indicate better accuracy in the original gradient recovery.

![](images/61cf6a355792482227849afc78476d474df6da198aa71aa789b2f5fb38ea2509.jpg)  
Figure 5: Comparisons on ground truth clientsâ€™ private images and corresponding recovered privacy images from MjÂ¨olnir variant models and commonly used traditional gradient leakage attacks. $\ : \ : ( \delta = 1 0 ^ { \frac { - 5 } { - 5 } }$ ; $\varepsilon = 1 0$ ; Success Rate: overall attack success rate)

# Privacy Leakage Capability

The comparison of overall privacy leakage capability from perturbed gradients of MjoÂ¨lnir and traditional Gradient Leakage Attacks (GRNN (Ren, Deng, and Xie 2022), IG (Geiping et al. 2020), and DLG (Zhu, Liu, and Han 2019)) under FL-DP, compares Image Average Peak Signal Noise Ratio $P S N R _ { i }$ and Label Recovered Accuracy $L R A$ of the recovered local clientsâ€™ privacy information. Local clientsâ€™ private training datasets are MNIST, CIFAR100, and STL10.

According to the numerical experimental results shown in Table 1 and the visualization results shown in Fig. 5, MjoÂ¨lnir variant models exhibit a substantial superiority over traditional gradient leakage attacks in terms of private image leakage. On average, there is an approximately $2 0 9 \%$ increase in the recovered image $P S N R _ { i }$ when using MjoÂ¨lnir. For traditional methods, GRNN consistently achieves an LRA metric of 1.000 by using a robust generative network for label recovery, while other methods update images and labels jointly, leading to less accurate results. Moreover, upon examining the private image recovery procedures of MjoÂ¨lnir variant models and traditional gradient leakage attacks illustrated in Fig. 4, it becomes evident that the attacks incorporating MjoÂ¨lnir not only achieve considerably improved accuracy in the ultimate reconstruction of private images compared to conventional approaches but also showcase notable advantages in terms of attack iteration rounds and speed (MjoÂ¨lnir (Conditional) $>$ M $\mathrm { j } \ddot { \mathrm { o l n i r } } > \mathrm { ~ N ~ }$ joÂ¨ lnir (Non-Adaptive)).

# Gradients Denoising under FL-DP

Among FL-DP, we choose the NbAFL framework (Wei et al. 2020) (Noising before model aggregation FL) as the threat model in this experiment due to its widespread adoption. To ensure a comprehensive evaluation of the effectiveness of the MjoÂ¨lnir, we train the three MjoÂ¨lnir variant models, as well as non-diffusion denoising models such as NBNet (Cheng et al. 2021), SS-BSN (Han and Yu 2023), and APBSN (Lee, Son, and Lee 2022), using gradients extracted from the surrogate downstream task model trained on the FashionMnist. Following that, we utilize the trained models to denoise the shared perturbed gradients intercepted by the attacker from the target clients. These target clients have locally trained downstream task models using privacy datasets (MNIST, CIFAR100, and STL10). The gradients are protected using the NbAFL(Wei et al. 2020) before being shared with the server. Based on the experimental results presented in Table 2, it is evident that MjoÂ¨lnir showcases superior denoising ability for perturbed gradients under FL-DP, with an average Cosine Similarity exceeding 0.992 and a PSNR of 37.68. This represents a significant improvement of over $2 7 \%$ compared to non-diffusion methods. Further analysis reveals that among the three MjoÂ¨lnir variant models, the performance can be ranked as follows: MjoÂ¨ lnir(Conditional) $>$ MjoÂ¨ lnir $>$ MjoÂ¨ lnir (Non-Adaptive). This ranking demonstrates both $M$ -Adaptive Process and Conditional training enhance the denoising and generation performance of MjoÂ¨lnirâ€™s Gradient Diffusion Model.

# Gradients Denoising under FL-PP

To evaluate the generalization capability of MjoÂ¨lnir on gradient denoising, we constructed two different types of noise (Laplace and Gaussian) randomly applied to each layer of the original gradients within the FL-PP framework. The training and inference processes of MjoÂ¨lnir variant models, and non-diffusion denoising models (NBNet (Cheng et al. 2021), SS-BSN (Han and Yu 2023), and AP-BSN (Lee, Son, and Lee 2022)) are the same as the above experiments on gradients denoising under FL-DP. In contrast to attacks specifically tailored for the FL-DP framework, the gradient denoising experiments on FL-PP showcase MjoÂ¨lnirâ€™s ability to effectively handle various types of perturbations and adapt to different magnitudes of perturbation. Referring to the experimental results illustrated in Fig. 6, it is observed that when subjected to Laplace perturbation, MjoÂ¨lnir variant models exhibit an average improvement of $2 1 . 6 \%$ in PSNR and $9 . 2 \%$ in Cosine Similarity. Similarly, under Gaussian perturbation, MjoÂ¨lnir achieves an average enhancement of $\mathrm { \bar { 2 } 1 . 3 \% }$ in PSNR and $9 . 1 \%$ in Cosine Similarity. These findings provide compelling evidence for the robustness and stability of the MjoÂ¨lnir variant models. We further compared the average inference time of different denoising models under FL-PP. Results presented in Table 3 indicate that MjoÂ¨lnir variant models exhibit a relative advantage in terms of gradient denoising speed, surpassing non-diffusion methods by an average improvement of $3 2 . 7 \%$ in inference time.

Table 2: Overall results on gradients denoising in FL-DP. Threat model setting: DP- $( \varepsilon , \delta ) = ( 2 , 1 0 ^ { - 5 } )$ with Gaussian perturbation   

<html><body><table><tr><td rowspan="2">Model</td><td colspan="2">MNIST</td><td colspan="2">CIRAF100</td><td colspan="2">STL10</td></tr><tr><td>CosSimilarg PSNRg|CosSimilarg PSNRg |CosSimilarg PSNRg</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>NBNet(Cheng et al. 2021)</td><td>0.992</td><td>35.74</td><td>0.979</td><td>27.51</td><td>0.979</td><td>27.23</td></tr><tr><td>SS-BSN(Han and Yu 2023)</td><td>0.995</td><td>32.35</td><td>0.845</td><td>22.85</td><td>0.845</td><td>22.84</td></tr><tr><td>AP-BSN(Lee, Son,and Lee 2022)</td><td>0.968</td><td>29.61</td><td>0.892</td><td>24.01</td><td>0.893</td><td>24.12</td></tr><tr><td>Mjolnir</td><td>0.996</td><td>38.76</td><td>0.990</td><td>30.42</td><td>0.990</td><td>30.01</td></tr><tr><td>Mjolnir(Non-Adaptive)</td><td>0.995</td><td>38.59</td><td>0.990</td><td>30.39</td><td>0.990</td><td>29.87</td></tr><tr><td>Mjolnir(Conditional)</td><td>0.996</td><td>38.78</td><td>0.990</td><td>30.53</td><td>0.993</td><td>30.22</td></tr></table></body></html>

![](images/e1fab7ae5f990c0aadde249caec6a3c97d6e6c516dc06d3fa4fb169c69652bd1.jpg)  
Figure 6: Gradients denoising under FL-PP: Gaussian and Laplace perturbed gradients denoising performance of $P S N R _ { g }$ and CosSimilar $\overset { \cdot } { \boldsymbol { g } }$ via different perturbation magnitudes. Perturbation decreases, $\varepsilon$ increases. (Private dataset: STL10, $\delta = 1 0 ^ { - 5 }$ )

Table 3: Gradient denoising average inference time of MjoÂ¨lnir variant models and non-diffusion denoising models under FL-PP. (Device: NVIDIA GeForce RTX 2060 GPU; Intel(R) Core(TM) i7-10870H CPU at 2.20GHz)   

<html><body><table><tr><td>Model</td><td>Inference time (s)</td></tr><tr><td>NBNet(Cheng et al.2021)</td><td>2.653</td></tr><tr><td>SS-BSN(Han and Yu 2023) AP-BSN(Lee,Son,andLee 2022)</td><td>26.15</td></tr><tr><td></td><td>7.138</td></tr><tr><td>Mjolnir Mjolnir(Non-Adaptive)</td><td>6.834 6.834</td></tr><tr><td>Mjolnir(Conditional)</td><td>6.917</td></tr><tr><td></td><td></td></tr></table></body></html>

Limitations: (1) MjoÂ¨ lnir is not effective in attacking perturbations that are not based on gradient diffusion (noise perturbation) such as representation perturbation. (2) The overall effectiveness of MjoÂ¨lnir in reconstructing privacy datasets is also bounded by the selected subsequent Gradient Leakage Attacks. (3) MjÂ¨olnir is used to attack CNN and (or) DNNbased models. Experimental results suggest that it struggles with transformer-based models due to their complex structure and larger number of parameters, making it difficult to accurately denoise gradients and recover data.

Defense Strategies: Possible defense strategies against MjoÂ¨lnir can be approached by preserving the privacy of original data, preserving the target attack models, and shared gradients protection. MjoÂ¨lnir effectively leaks privacy data by attacking the perturbed shared gradients, which suggests that the possible defense approaches against MjoÂ¨lnir should either be non-perturbation gradient protection methods or non-gradient privacy-preserving methods.

# Conclusion

This paper makes the first attempt to investigate the diffusion property of the widely used perturbation-based gradient protection. To reveal potential vulnerabilities, we propose a novel Perturbation-Resilient Gradient Leakage Attack via an adaptive diffusion process. This effective attack paradigm deactivates perturbation protection by leveraging the denoising capability of diffusion models without access to clientsâ€™ models and external data. Based on MjÂ¨olnir, we wish to enhance public consciousness of the privacy leakage issues of existing perturbation-based defenses on gradients.